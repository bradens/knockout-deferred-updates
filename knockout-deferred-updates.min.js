/*
 Deferred Updates plugin for Knockout http://knockoutjs.com/
 (c) Michael Best, Steven Sanderson
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 3.0.1
*/
(function(a){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?a(require("knockout")):"function"===typeof define&&define.amd?define(["knockout"],a):a(ko)})(function(a){function u(d,a){for(var b in d)if(d.hasOwnProperty(b)&&d[b]&&0<=d[b].toString().indexOf(a))return b}function r(d,a){for(var b in d)if(d.hasOwnProperty(b)&&d[b]===a)return b}function Q(d,a,b,c){var k=d.subscribe(a,null,"dirty",!1,c),f=d.subscribe(b,null,"change",!1,c);return{dispose:function(){k.dispose();
f.dispose()},target:d}}var D="object"===typeof global&&global?global:window;if(!a)throw Error("Deferred Updates requires Knockout");if("3.1.0"<=a.version)throw Error("This version of Deferred Updates supports Knockout version 3.0 and lower.");a.tasks=function(){function d(d){var b=0;try{for(var a=d;a=a._next;)v=a,a._done||(a._done=!0,a._func.apply(a.object,a.args||[]),b++)}finally{if(d!==f)d._next=null,q=d;else{m=[];f._next=null;e=q=f;if(k)D[c](k);k=void 0}v=void 0}return b++}function p(){if(!v)return d(f)}
var b,c;D.setImmediate?(b="setImmediate",c="clearImmediate"):(b="setTimeout",c="clearTimeout");var k,f={},q=f,m=[],v,e=f,g={processImmediate:function(a,b,p){m.push(e);e=q;try{return a.apply(b,p||[])}finally{try{e._next&&d(e)}finally{e=m.pop()||f}}},processDelayed:function(a,d,c){2==arguments.length&&"object"==typeof d&&(c=d,d=c.distinct);var h;if(h=d||void 0===d)a:{h=v||e;for(var f;f=h._next;h=f)if(f._func===a&&!f._done){h._next=f._next;h._next||(q=h);h=!0;break a}h=!1}f=c||{};f._func=a;q=q._next=
f;m.length||k||(k=D[b](p));return!h},makeProcessedCallback:function(a){return function(){return g.processImmediate(a,this,arguments)}}};a.processDeferredBindingUpdatesForNode=a.processAllDeferredBindingUpdates=function(){for(var a=f;a=a._next;)a.node&&!a._done&&(a._done=!0,a._func.call())};a.processAllDeferredUpdates=p;a.evaluateAsynchronously=function(a,d){return setTimeout(g.makeProcessedCallback(a),d)};return g}();a.utils.objectForEach||(a.utils.objectForEach=function(a,p){for(var b in a)a.hasOwnProperty(b)&&
p(b,a[b])});a.utils.objectMap||(a.utils.objectMap=function(a,p){if(!a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=p(a[c],c,a));return b});var g=function(a,c){for(var b in a)if(a.hasOwnProperty(b)&&a[b]&&a[b][c])return a[b]}(a,"end"),R=u(g,".apply(")||"ignore",J=u(g,":[]"),K=u(g,".length"),w=a.computed,S=r(a,w),H=r(w.fn,w),c=a.computed(function(){}),T=r(c,c.peek)||"peek",U=r(c,c.isActive)||"isActive",V=r(c,c.getDependenciesCount),L=r(c,!1),W=r(c,c.dispose),M="disposeWhenNodeIsRemoved",
N="disposeWhen";if("hasWriteFunction"!=L){var c=w.toString(),z;if(z=c.match(/.\.disposeWhenNodeIsRemoved\s*\|\|\s*.\.([^|\s,]+)/))M=z[1];if(c=c.match(/.\.disposeWhen\s*\|\|\s*.\.([^|\s,]+)/))N=c[1]}var X=u(a.utils,"documentElement)")||u(a.utils,"ocument)"),c=a.subscribable.fn;z=u(c,".bind(");var B=(new a.subscribable).subscribe(),O=B.dispose,P=B.constructor.prototype,Y=r(P,O);B.dispose();var B=null,t=[],Z=0;g[J]=function(a){t.push(a)};g.end=function(){t.pop()};g[K]=function(d){if(!a.isSubscribable(d))throw Error("Only subscribable things can act as dependencies");
if(0<t.length){var c=t[t.length-1];c&&c(d,d._id=d._id||++Z)}};a.ignoreDependencies=g[R]=function(a,c,b){try{return t.push(null),a.apply(c,b||[])}finally{t.pop()}};var $=c[z];c[z]=function(d,c,b,g,k){b=b||"change";var f;if(k)f=function(a){d(a,b)},"change"==b&&(this.dependents=this.dependents||[],this.dependents.push(k));else{var q=function(a){d.call(c,a,b)};f="change"!=b?q:function(b){x.deferUpdates&&!1!==m.deferUpdates||m.deferUpdates?a.tasks.processDelayed(q,{args:[b]}):q(b)}}var m=$.call(this,f,
null,b);m.target=this;m.event=b;m.dependent=k;m.deferUpdates=g;return m};var E=c.notifySubscribers,n;c.notifySubscribers=function(a,c){if("change"===c||"dirty"===c||void 0===c)if(n)n.push([this,a,c]);else try{if(n=[],E.call(this,a,c),n.length)for(var b=0,g;g=n[b];b++)Function.prototype.call.apply(E,g)}finally{n=null}else E.call(this,a,c)};c.getDependents=function(){return this.dependents?[].concat(this.dependents):[]};P[Y]=function(){O.call(this);this.dependent&&"change"==this.event&&a.utils.arrayRemoveItem(this.target.dependents,
this.dependent)};var x=function(c,p,b){function r(){a.utils.objectForEach(C,function(a,b){b.dispose()});a.utils.arrayForEach(z,function(a){a.dispose()});C={};n=0;z=[];s=l=!1}function k(b,c){var d="dirty"==c,f=d&&!s&&!l;d?s=!0:l=!0;(d=e.throttleEvaluation)&&0<=d?(clearTimeout(B),B=a.evaluateAsynchronously(v,d)):x.deferUpdates&&!1!==e.deferUpdates||e.deferUpdates?f=a.tasks.processDelayed(v,{node:F}):l&&(v(),f=!1);f&&e.notifySubscribers&&(e.notifySubscribers(y,"dirty"),!s&&d&&clearTimeout(B))}function f(a,
b){s||l?l=!0:k(a,b)}function q(a,b){if(!C[b]){var c;c=a[H]===x?Q(a,k,f,e):a.subscribe(k,null,"change",!1,e);C[b]=c;n++}}function m(){if(E&&E()){if(!t)return G(),l=!1,!0}else t=!1}function v(b){if(h||!l&&!0!==b)s=l;else if(!m()){h=!0;try{var c=a.utils.objectMap(C,function(){return!0}),d=n;g[J](function(a,b){c[b]?(c[b]=void 0,d--):q(a,b)});var f=A.call(p);d&&a.utils.objectForEach(c,function(a,b){b&&(C[a].dispose(),delete C[a],n--)});s=l=!1;e.equalityComparer&&e.equalityComparer(y,f)||(e.notifySubscribers(y,
"beforeChange"),y=f,e._latestValue=y,e.notifySubscribers(y))}finally{g.end(),s=l=h=!1}}}function e(){if(0<arguments.length){if("function"===typeof u){var a=e.deferUpdates;e.deferUpdates=!1;try{u.apply(p,arguments)}finally{e.deferUpdates=a}}else throw Error('Cannot write a value to a ko.computed unless you specify a "write" option. If you wish to read the current value, don\'t pass any parameters.');return this}(l||s)&&v(!0);g[K](e);return y}function w(){return l||s||0<n}var y,s=!1,l=!0,h=!1,t=!1,
A=c;A&&"object"==typeof A?(b=A,A=b.read):(b=b||{},A||(A=b.read));if("function"!=typeof A)throw Error("Pass a function that returns the value of the ko.computed");var u=b.write;p||(p=b.owner);var C={},n=0,z=[],B=null,I,F=b[M]||b.disposeWhenNodeIsRemoved||null,D=b[N]||b.disposeWhen,E=D,G=r;F&&(t=!0,F.nodeType&&(E=function(){return!a.utils[X](F)||D&&D()}));if(!m()&&!0!==b.deferEvaluation){h=!0;try{g[J](q),e._latestValue=y=A.call(p)}finally{g.end(),l=h=!1}}F&&w()&&(G=function(){a.utils.domNodeDisposal.removeDisposeCallback(F,
G);r()},a.utils.domNodeDisposal.addDisposeCallback(F,G));a.subscribable.call(e);a.utils.extend(e,x.fn);e[T]=e.peek=function(){(l||s)&&v(!0);return y};e[V]=e.getDependenciesCount=function(){return n};e[L]=e.hasWriteFunction="function"===typeof u;e[W]=e.dispose=function(){G()};e[U]=e.isActive=w;e.activeWhen=function(b){I||(I=a.computed(function(){h=!b();!h&&l&&k(void 0,"change")}),I.deferUpdates=!1,z.push(I))};e.getDependencies=function(){var b=[];a.utils.objectForEach(C,function(a,c){b.push(c.target)});
return b};return e};x[H]=w[H];x.fn=w.fn;x.fn[H]=x;x.deferUpdates=!0;a[S]=a.computed=a.dependentObservable=x;w=c=null;a.extenders.throttle=function(c,g){if(a.isWriteableObservable(c)){var b=null;return a.computed({read:c,write:function(n){clearTimeout(b);b=a.evaluateAsynchronously(function(){c(n)},g)}})}c.throttleEvaluation=g;return c};a.extenders.deferred=function(a,c){a.deferUpdates=c};return a});